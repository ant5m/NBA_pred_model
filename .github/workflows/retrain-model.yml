name: Weekly Model Retraining

on:
  schedule:
    - cron: '0 7 * * 0'  # Sundays at 2 AM EST (7 AM UTC)
  workflow_dispatch:  # Allow manual trigger

jobs:
  retrain-model:
    runs-on: ubuntu-latest
    timeout-minutes: 120  # 2 hour timeout for training
    
    steps:
      - name: Trigger model retraining
        run: |
          response=$(curl -X POST "${{ secrets.RAILWAY_URL }}/admin/retrain-model" \
            -H "Content-Type: application/json" \
            -w "\n%{http_code}" \
            -s)
          
          http_code=$(echo "$response" | tail -n 1)
          body=$(echo "$response" | sed '$d')
          
          echo "$body"
          
          if [ "$http_code" != "200" ]; then
            echo "❌ Retraining failed with status code: $http_code"
            exit 1
          fi
          
          echo "✅ Model retraining completed successfully"
